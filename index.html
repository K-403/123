<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI对话助手</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome图标 -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            neutral: {
              100: '#F3F4F6',
              200: '#E5E7EB',
              700: '#374151',
              800: '#1F2937',
              900: '#111827'
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .typing-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
      }
      .typing-indicator span {
        height: 0.5rem;
        width: 0.5rem;
        background-color: #3B82F6;
        border-radius: 50%;
        display: inline-block;
        animation: typing 1.4s infinite ease-in-out both;
      }
      .typing-indicator span:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: -0.16s;
      }
      @keyframes typing {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1); }
      }
    }
  </style>
</head>
<body class="font-inter bg-neutral-100 text-neutral-800 min-h-screen flex flex-col">
  <!-- 顶部导航 -->
  <header class="bg-white border-b border-neutral-200 py-4 px-6 shadow-sm">
    <div class="max-w-5xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fa fa-comments text-primary text-xl"></i>
        <h1 class="text-xl font-semibold">AI对话助手</h1>
      </div>
      <div class="text-sm text-neutral-700">
        <span>模型:</span>
        <span class="font-medium ml-1">deepseek-r1t2-chimera</span>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 flex flex-col max-w-5xl w-full mx-auto w-full px-4 py-6">
    <!-- 对话区域 -->
    <div id="chat-container" class="flex-1 mb-6 overflow-y-auto scrollbar-hide space-y-6">
      <!-- 初始提示消息 -->
      <div class="flex items-start gap-3">
        <div class="bg-primary text-white rounded-full p-2 h-fit">
          <i class="fa fa-robot"></i>
        </div>
        <div class="bg-white rounded-2xl p-4 shadow-sm max-w-[85%]">
          <p>你好！我是AI助手，有什么可以帮助你的吗？</p>
        </div>
      </div>
    </div>

    <!-- 输入区域 -->
    <div class="bg-white rounded-2xl shadow-md p-4">
      <form id="chat-form" class="flex flex-col gap-3">
        <textarea 
          id="user-input" 
          rows="3" 
          placeholder="输入你的问题..." 
          class="w-full p-3 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none transition-all"
          required
        ></textarea>
        <div class="flex justify-end">
          <button 
            type="submit" 
            id="send-btn"
            class="bg-primary hover:bg-primary/90 text-white px-6 py-2.5 rounded-full flex items-center gap-2 transition-all transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100"
          >
            <span>发送</span>
            <i class="fa fa-paper-plane"></i>
          </button>
        </div>
      </form>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-neutral-200 py-3 px-6 text-center text-sm text-neutral-700">
    <p>© 2023 AI对话助手 | 简洁高效的智能交互体验</p>
  </footer>

  <script>
    // DOM元素
    const chatContainer = document.getElementById('chat-container');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    
    // API配置
    const baseURL = 'https://openrouter.ai/api/v1';
    const apiKey = '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';
    const model = 'tngtech/deepseek-r1t2-chimera:free';
    
    // 添加消息到聊天容器
    function addMessage(content, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex items-start gap-3 ${isUser ? 'justify-end' : ''}`;
      
      const avatar = document.createElement('div');
      avatar.className = `${isUser ? 'bg-neutral-700' : 'bg-primary'} text-white rounded-full p-2 h-fit`;
      avatar.innerHTML = isUser ? '<i class="fa fa-user"></i>' : '<i class="fa fa-robot"></i>';
      
      const contentBubble = document.createElement('div');
      contentBubble.className = `rounded-2xl p-4 shadow-sm max-w-[85%] ${
        isUser ? 'bg-neutral-800 text-white' : 'bg-white'
      }`;
      contentBubble.textContent = content;
      
      if (isUser) {
        messageDiv.appendChild(contentBubble);
        messageDiv.appendChild(avatar);
      } else {
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(contentBubble);
      }
      
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      return contentBubble;
    }
    
    // 添加打字指示器
    function addTypingIndicator() {
      const indicatorDiv = document.createElement('div');
      indicatorDiv.className = 'flex items-start gap-3';
      indicatorDiv.id = 'typing-indicator';
      
      const avatar = document.createElement('div');
      avatar.className = 'bg-primary text-white rounded-full p-2 h-fit';
      avatar.innerHTML = '<i class="fa fa-robot"></i>';
      
      const bubble = document.createElement('div');
      bubble.className = 'bg-white rounded-2xl p-4 shadow-sm max-w-[85%]';
      
      const indicator = document.createElement('div');
      indicator.className = 'typing-indicator';
      indicator.innerHTML = '<span></span><span></span><span></span>';
      
      bubble.appendChild(indicator);
      indicatorDiv.appendChild(avatar);
      indicatorDiv.appendChild(bubble);
      
      chatContainer.appendChild(indicatorDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      return indicatorDiv;
    }
    
    // 移除打字指示器
    function removeTypingIndicator() {
      const indicator = document.getElementById('typing-indicator');
      if (indicator) {
        indicator.remove();
      }
    }
    
    // 处理流式响应
    async function handleStreamResponse(response, messageElement) {
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let fullResponse = '';
      
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        
        // 解码收到的字节
        const chunk = decoder.decode(value, { stream: true });
        // 分割SSE事件
        const lines = chunk.split('\n');
        
        for (const line of lines) {
          if (line.trim() === '') continue;
          if (line.startsWith('data:')) {
            const data = line.slice(5).trim();
            if (data === '[DONE]') break;
            
            try {
              const json = JSON.parse(data);
              const content = json.choices[0]?.delta?.content;
              if (content) {
                fullResponse += content;
                messageElement.textContent = fullResponse;
                chatContainer.scrollTop = chatContainer.scrollHeight;
              }
            } catch (e) {
              console.error('解析JSON失败:', e);
            }
          }
        }
      }
      
      return fullResponse;
    }
    
    // 发送消息到API
    async function sendMessage(message) {
      // 添加用户消息
      addMessage(message, true);
      
      // 清空输入框
      userInput.value = '';
      
      // 禁用发送按钮
      sendBtn.disabled = true;
      
      // 添加打字指示器
      addTypingIndicator();
      
      try {
        // 准备请求数据
        const requestData = {
          model: model,
          messages: [
            {
              role: "user",
              content: message
            }
          ],
          stream: true
        };
        
        // 发送请求
        const response = await fetch(`${baseURL}/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${apiKey}`
          },
          body: JSON.stringify(requestData)
        });
        
        if (!response.ok) {
          throw new Error(`HTTP错误! 状态码: ${response.status}`);
        }
        
        // 移除打字指示器
        removeTypingIndicator();
        
        // 创建AI消息容器
        const aiMessageElement = addMessage('', false);
        
        // 处理流式响应
        await handleStreamResponse(response, aiMessageElement);
        
      } catch (error) {
        console.error('发送消息失败:', error);
        removeTypingIndicator();
        addMessage(`抱歉，发生错误: ${error.message}`, false);
      } finally {
        // 重新启用发送按钮
        sendBtn.disabled = false;
      }
    }
    
    // 表单提交处理
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = userInput.value.trim();
      if (message) {
        await sendMessage(message);
      }
    });
    
    // 按Enter发送消息，Shift+Enter换行
    userInput.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        const message = userInput.value.trim();
        if (message) {
          await sendMessage(message);
        }
      }
    });
    
    // 自动调整文本框高度
    userInput.addEventListener('input', () => {
      userInput.style.height = 'auto';
      userInput.style.height = (Math.min(userInput.scrollHeight, 200)) + 'px';
    });
  </script>
</body>
</html>